import "std/log"
import "std/string"

// Note: log output goes to stderr, so we test the configuration API
// and that calls don't crash. Verifying exact output would require
// capturing stderr which isn't available in the test framework.

test "setLevel to debug" {
    setLevel(LOG_DEBUG)
    @assert_eq(log_level, 0)
}

test "setLevel to info" {
    setLevel(LOG_INFO)
    @assert_eq(log_level, 1)
}

test "setLevel to warn" {
    setLevel(LOG_WARN)
    @assert_eq(log_level, 2)
}

test "setLevel to error" {
    setLevel(LOG_ERROR)
    @assert_eq(log_level, 3)
}

test "setLevel to none suppresses all" {
    setLevel(LOG_NONE)
    @assert_eq(log_level, 4)
}

test "setTimestamps disables" {
    setTimestamps(false)
    @assert_eq(log_timestamps, false)
}

test "setTimestamps enables" {
    setTimestamps(true)
    @assert_eq(log_timestamps, true)
}

test "log level constants are ordered" {
    @assert(LOG_DEBUG < LOG_INFO)
    @assert(LOG_INFO < LOG_WARN)
    @assert(LOG_WARN < LOG_ERROR)
    @assert(LOG_ERROR < LOG_NONE)
}

test "debug does not crash" {
    setLevel(LOG_NONE)
    setTimestamps(false)
    debug("test debug message")
    @assert(true)
}

test "info does not crash" {
    setLevel(LOG_NONE)
    setTimestamps(false)
    info("test info message")
    @assert(true)
}

test "warn does not crash" {
    setLevel(LOG_NONE)
    setTimestamps(false)
    warn("test warn message")
    @assert(true)
}

test "logError does not crash" {
    setLevel(LOG_NONE)
    setTimestamps(false)
    logError("test error message")
    @assert(true)
}

test "debugKv does not crash" {
    setLevel(LOG_NONE)
    setTimestamps(false)
    debugKv("request", "method", "GET")
    @assert(true)
}

test "infoKv does not crash" {
    setLevel(LOG_NONE)
    setTimestamps(false)
    infoKv("request", "status", "200")
    @assert(true)
}
