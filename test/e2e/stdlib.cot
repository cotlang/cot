// Cross-file generic import test.
// Imports List(T) from stdlib and exercises it across file boundaries.

import "std/list"

fn cmp_asc(a: i64, b: i64) i64 {
    if a < b { return 0 - 1 }
    if a > b { return 1 }
    return 0
}

test "cross-file list append and get" {
    var list: List(i64) = .{}
    list.append(10)
    list.append(20)
    list.append(30)
    @assert_eq(list.len(), 3)
    @assert_eq(list.get(0), 10)
    @assert_eq(list.get(1), 20)
    @assert_eq(list.get(2), 30)
    list.free()
}

test "cross-file list set" {
    var list: List(i64) = .{}
    list.append(10)
    list.append(20)
    list.append(30)
    list.set(1, 42)
    @assert_eq(list.get(1), 42)
    list.free()
}

test "cross-file list pop" {
    var list: List(i64) = .{}
    list.append(10)
    list.append(20)
    list.append(30)
    var popped = list.pop()
    @assert_eq(popped, 30)
    @assert_eq(list.len(), 2)
    list.free()
}

test "cross-file list insert" {
    var list: List(i64) = .{}
    list.append(10)
    list.append(42)
    list.insert(0, 99)
    @assert_eq(list.get(0), 99)
    @assert_eq(list.get(1), 10)
    @assert_eq(list.len(), 3)
    list.free()
}

test "cross-file list clear" {
    var list: List(i64) = .{}
    list.append(10)
    list.append(20)
    list.clear()
    @assert_eq(list.len(), 0)
    list.free()
}

test "list sort ascending" {
    var list: List(i64) = .{}
    list.append(3)
    list.append(1)
    list.append(4)
    list.append(1)
    list.append(5)
    list.sort(cmp_asc)
    @assert_eq(list.get(0), 1)
    @assert_eq(list.get(1), 1)
    @assert_eq(list.get(2), 3)
    @assert_eq(list.get(3), 4)
    @assert_eq(list.get(4), 5)
    list.free()
}

test "list sort already sorted" {
    var list: List(i64) = .{}
    list.append(1)
    list.append(2)
    list.append(3)
    list.sort(cmp_asc)
    @assert_eq(list.get(0), 1)
    @assert_eq(list.get(1), 2)
    @assert_eq(list.get(2), 3)
    list.free()
}

test "list isSorted" {
    var list: List(i64) = .{}
    list.append(1)
    list.append(2)
    list.append(3)
    @assert_eq(list.isSorted(cmp_asc), 1)
    list.append(0)
    @assert_eq(list.isSorted(cmp_asc), 0)
    list.free()
}
